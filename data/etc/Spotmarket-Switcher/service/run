#!/bin/sh
sleep 25
#remove double lines to correct a bug of a old version of the run script
awk 'seen["(crontab -l \| grep -Fxq \"0 * * * * /data/etc/Spotmarket-Switcher/controller.sh\") \|\| (crontab -l; echo \"0 * * * * /data/etc/Spotmarket-Switcher/controller.sh\") \| crontab -"]++ == 0' rc.local > rc.local.tmp && mv rc.local.tmp rc.local
#Add crontab at system start only if it doesnt exist
echo '(crontab -l | grep -Fxq "0 * * * * /data/etc/Spotmarket-Switcher/controller.sh") || (crontab -l; echo "0 * * * * /data/etc/Spotmarket-Switcher/controller.sh") | crontab -' >> /data/rc.local
